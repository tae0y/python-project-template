# .claude/ Review — 2026-02-22

**Reviewed by:** 5-agent team (Prompt Engineer, Agent Harness Evangelist, Token CFO, Code Quality Lead, Onboarding New Member)
**Source material:** `.claude/` directory, `real-estate-mcp` and `that-night-sky` worklogs, ADRs, learn files
**Method:** 3-round structured debate with cross-challenge requirements

---

## Verdict

**The current `.claude/` setup is helping this developer — but with meaningful drag from two specific files.**

The evidence base (worklogs, ADRs, learn files across two production-scale projects) shows strong compliance with `coding-guidelines.md` (Rules 2, 4, 5, 6, 7, 8 all have concrete adoption artifacts). The document management convention (`localdocs/`) is followed consistently. The hooks (`check-new-test-file.sh`, `check-external-lib-usage.sh`) are well-scoped and correctly calibrated (hard block vs advisory).

The setup is failing in exactly two places: `thinking-guidelines.md` actively contradicts the structured outputs required by skills and the English-only commit convention — meaning rules are silently violated every session. And `tdd-guardian.md` is contaminated with TypeScript idioms that don't belong in a Python project. Fix these two files and the system gets materially better. The rest is incremental polish.

---

## Prioritized Action List

### P1 — Rewrite `tdd-guardian.md` with Python/pytest examples
**Owner: New Member perspective (all teammates agree)**
**Rationale:** The only issue in the entire `.claude/` setup that produces *wrong behavior* rather than confusion. The "Project-Specific Guidelines" section (lines 284–315) explicitly states TypeScript/Zod/interface conventions as if they are this project's rules. A Python developer following these instructions will write Jest-style patterns in pytest. This undermines trust in the entire setup and generates incorrect code.
**Scope:** Replace `jest.spyOn`/`beforeEach`/`let` examples with `pytest` fixtures and `monkeypatch`. Replace TypeScript type annotations with Python type hints. Remove "TypeScript strict mode", "Zod", "`type` vs `interface`" from guidelines. Keep all TDD methodology content (RED-GREEN-REFACTOR cycle) unchanged.
**Effort:** 1–2 hours (bounded, non-controversial, universal agreement)

---

### P2 — Delete `thinking-guidelines.md`, inline 4–5 lines into `CLAUDE.md`
**Owner: Token CFO + Prompt Engineer (New Member agrees)**
**Rationale:** `thinking-guidelines.md` contains three critical contradictions:
- Rule 3 says "plain text by default; avoid headings/lists unless requested" — violated by every skill that produces structured markdown (worklog, planning, check, tdd-guardian)
- Rule 3 says "Write in Korean" with no scope boundary — contradicts `commit-convention.md` which mandates English
- Rule 2 (multi-persona analysis) has zero evidence of adoption across two projects and ~40 worklog entries — it is a dead rule that multiplies output tokens without demonstrated value

**Proposed replacement** (add to `CLAUDE.md` under `## Communication and Reasoning Style`):
```markdown
- Respond in Korean (해요/어요 체). Concise, analytical, no filler, no emojis.
- State conclusions first, then constraints. Affirmative form first ("It is B" not "not A").
- Separate verifiable facts, assumptions, and user preferences before answering complex questions.
- Conversation output in Korean; code, commits, documentation, and structured skill output in English.
```
**Effort:** 15 minutes. Saves ~420 input tokens + ~2,000 output tokens per session.

---

### P3 — Add commit convention PostToolUse warning hook
**Owner: Quality Lead**
**Rationale:** The commit convention (`[MAINTENANCE]`/`[NEW FEATURE]`/`[BREAKING CHANGES]`) was added 2026-02-22 and has not been tested in practice. A soft reminder hook (PostToolUse, exit 0) gives the convention visibility without blocking rapid iteration sessions. The hook ships automatically with the template repo — unlike a git-level hook which requires manual installation per clone.
**Implementation:**
```bash
#!/bin/bash
# PostToolUse: check-commit-convention.sh
INPUT=$(cat)
TOOL=$(echo "$INPUT" | jq -r '.tool_name // empty')
[[ "$TOOL" != "Bash" ]] && exit 0
COMMAND=$(echo "$INPUT" | jq -r '.tool_input.command // empty')
echo "$COMMAND" | grep -q 'git commit' || exit 0
MSG=$(git log -1 --format='%s' 2>/dev/null)
[[ -z "$MSG" ]] && exit 0
if ! echo "$MSG" | grep -qE '^\[(MAINTENANCE|NEW FEATURE|BREAKING CHANGES)\]'; then
  echo "[Hook] Commit message does not follow convention: \"$MSG\"" >&2
  echo "Expected prefix: [MAINTENANCE], [NEW FEATURE], or [BREAKING CHANGES]" >&2
  echo "Consider: git commit --amend -m \"[PREFIX] $MSG\"" >&2
fi
exit 0
```
**Effort:** 20 minutes.

---

### P4 — Create `/project:resume` command
**Owner: Evangelist**
**Rationale:** Both project worklogs show multi-day sessions where context resumption is the first manual task every session (read `worklog.doing.md`, find the active plan, recall where things left off). The `progress-guardian` agent writes checkpoints but there is no corresponding session-start counterpart. A 30-line command template eliminates the highest-friction manual step observed across both projects.
**What it reads:** `localdocs/worklog.doing.md`, `localdocs/worklog.todo.md`, the active `localdocs/plan.*.md`, most recent `localdocs/learn.*.md`.
**Effort:** 30 minutes (markdown template, no code).

---

### P5 — Add ADR naming convention to `document-management.md`
**Owner: Quality Lead**
**Rationale:** ADRs are the most architecturally significant documents in both projects (4 in real-estate-mcp, 11 in that-night-sky) but the document-management naming table has no ADR entry. Both projects already show naming drift (`adr-001-*` kebab vs `adr.*` dot-prefix coexisting in real-estate-mcp). Add one table row:

| Architecture Decision Record | `adr/adr-NNN-*.md` | `localdocs/adr/adr-001-mcp-refactor.md` |

And one rule: "ADR numbers are sequential per project. Use kebab-case after the number. Never reuse or skip numbers."
**Effort:** 5 minutes.

---

### Backlog (not urgent but documented)

| Item | Who identified | Why deferred |
|------|---------------|--------------|
| Fix hardcoded absolute paths in `commands/review-team.md` | New Member | Low frequency command; only breaks on other machines |
| Add `settings.local.json` to `.gitignore` | New Member | Security hygiene; low immediate risk |
| Add `localdocs/` bootstrap instructions to `document-management.md` | Prompt Engineer | Missing but low-friction to discover manually |
| Explain `skills.nouse/` convention in `CLAUDE.md` | New Member | One line addition |
| Add secret/domain hygiene rule | Prompt Engineer + Quality Lead | DDNS leak incident; codify prevention |
| Add scoping clause to tdd-guardian ("TDD exemptions: infra, spikes, docs") | Prompt Engineer | Prevents TDD dogma blocking legitimate exploratory work |
| Remove unused MCP servers (arxiv, playwright) from `settings.json` | Token CFO | No evidence of use; pure context overhead |
| Add uv explanation parenthetical to `coding-guidelines.md` Rule 5 | Prompt Engineer | Minor, one parenthetical |
| Add entry point / reading order to `CLAUDE.md` | Prompt Engineer | Helps template forks; low complexity |
| Consider git-level `commit-msg` hook as complement to P3 | Token CFO | Better coverage (non-Claude commits); requires per-clone setup |

---

## Conflict Resolutions (finalized after Round 3 peer messaging)

### CONFLICT 1 — thinking-guidelines.md: RESOLVED (3-way agreement)

All three parties (CFO, Prompt Engineer, New Member) converged on:
- **Delete** `.claude/rules/thinking-guidelines.md`
- **Inline** these 5 lines into `CLAUDE.md` under `## Communication and Reasoning Style`:

```markdown
- Respond in Korean (해요/어요 체). Concise and analytical. Code, commits, and structured output remain in English.
- State the conclusion first. Separate facts from assumptions.
- Before answering complex questions, decompose into facts, assumptions, and preferences.
- Frame conclusions affirmatively ("It is B") before addressing alternatives.
- No praise, filler, or emojis.
```

**Dropped:** Multi-persona rule (Rule 2) — zero usage evidence, highest output token cost. Follow-up suggestions (Rule 4) — no demonstrated value.
**Net change:** -1 file, -52 lines, +5 inline lines. Korean/English boundary now explicit.

### CONFLICT 2 — Commit convention enforcement mechanism: RESOLVED (staged approach)

All three parties (CFO, Evangelist, Quality Lead) agreed on a staged implementation:

1. **Immediate (P3):** PostToolUse soft warning hook in `.claude/hooks/check-commit-convention.sh` — exit 0, non-blocking. Ships automatically with template repo. Catches ~90% of commits (Claude-authored).
2. **Backlog follow-up:** Add `commit-msg` stage to existing `.pre-commit-config.yaml` — git-level enforcement via pre-commit framework. Catches all commits from all sources (Claude, manual, Codex, CI). Requires `pre-commit install` per clone.

**Trade-off statement:** Git-level hook has broader coverage (catches non-Claude commits) but requires per-clone setup. Claude hook ships automatically in the template but only catches Claude Code sessions. For a solo developer working primarily through Claude, the Claude hook covers the dominant use case immediately. The git hook provides defense-in-depth when team usage or CI begins.

**Rejected:** PreToolUse hard block hook — hard-blocking commits wastes retry tokens and creates disproportionate friction for a format issue that's easily amended.

---

## Round 2 CFO Challenge Outcomes (Evangelist Proposals)

| Proposal | CFO Verdict | Team Outcome |
|----------|-------------|--------------|
| Commit convention hook | Accept (as git hook) | Adopted as P3 (Claude hook) |
| Worklog state consistency hook | Reject — no evidence of problem | Rejected |
| Localdocs naming validation hook | Accept | Backlog (low urgency) |
| Quality gate hook before commit | Reject — pre-commit already does this | Rejected |
| `/project:resume` command | Conditional accept | Adopted as P4 |
| Pre-commit integration skill | Reject — Claude already knows this | Rejected |
| Cross-project sync command | Reject — use git submodules instead | Rejected |
| Parallel check+audit | Accept — zero cost | Document as usage pattern |
| Parallel knowledge merge (learn+adr) | Accept — zero cost | Document as usage pattern |

---

## What Was Confirmed Working Well

- `coding-guidelines.md`: Strong ROI with concrete evidence across both projects. Rules 2, 4, 5, 6, 7, 8 all show adoption artifacts (learn files, worklog entries, ADRs). The "test heuristics" per rule are excellent prompt design.
- `document-management.md`: The worklog naming convention (`todo/doing/done`) is followed consistently across both projects. One topic per file discipline is maintained.
- `check-new-test-file.sh` and `check-external-lib-usage.sh`: Well-calibrated (hard block vs advisory). The external lib hook directly contributed to Auth0 endpoint discovery patterns visible in learn files.
- `commit-convention.md` itself: The three-prefix convention is sound. Missing `[FIX]` is intentional — bug fixes belong in `[MAINTENANCE]` unless they change external contract. The design is correct; only enforcement was missing.
- The `localdocs/` ecosystem: ADRs, learn files, and worklog patterns are mature and well-used. The learn files (`learn.auth0-oauth.md`, `learn.numpy2-nan-cast-and-skyfield-range-error.md`, `learn.i18n-consistency.md`) are high-quality and exactly the right knowledge capture format.
